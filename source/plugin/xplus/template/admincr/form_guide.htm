<div class="bm bw0">
<!--{if $inguide == 1}-->
<ul class="tb cl">
	<li{if $step == 1} class="a"{/if}><a href="plugin.php?id=xplus:admincr&mod=form&action=guide&step=1&inguide=$inguide">{lang xplus:form_guide_step1}</a></li>
	<li{if $step == 2} class="a"{/if}><a href="plugin.php?id=xplus:admincr&mod=form&action=guide&step=2&formid=$formid&inguide=$inguide">{lang xplus:form_guide_step2}</a></li>	
	<li{if $step == 3} class="a"{/if}><a href="plugin.php?id=xplus:admincr&mod=form&action=guide&step=3&formid=$formid&inguide=$inguide">{lang xplus:form_guide_step3}</a></li> 
    <!--{if $step == 2}-->
        <!-- {eval $next = $step + 1;} -->
        <li class="o y"><a href="plugin.php?id=xplus:admincr&mod=form&action=guide&step={$next}{if $formid}&formid=$formid{/if}&inguide=$inguide">{lang xplus:guide_nextstep}</a></li>
    <!--{elseif $step == 3 }-->
        <li class="o y"><a href="plugin.php?id=xplus:admincr&mod=form&action=list">{lang xplus:guide_finish}</a></li>
    <!--{/if}-->
</ul>
<!--{else}-->
<ul class="tb cl">
	<li{if $step == 2} class="a"{/if}><a href="plugin.php?id=xplus:admincr&mod=form&action=guide&step=2&formid=$formid&inguide=0">{lang xplus:form_list_edit}</a></li>
	<li{if $step == 3} class="a"{/if}><a href="plugin.php?id=xplus:admincr&mod=form&action=guide&step=3&formid=$formid&inguide=0">{lang xplus:form_list_field}</a></li>
	<li{if $action == 'rlist'} class="a"{/if}><a href="plugin.php?id=xplus:admincr&mod=form&action=rlist&formid=$formid">{lang xplus:form_rlist}</a></li>
</ul>
<!--{/if}-->
</div> 
<!--{if $step == 1}-->
<div class="bm bw0"> 
	<div class="exfm">
	<h2>{lang xplus:form_guide_new}</h2> 
		<form method="POST" action="plugin.php?id=xplus:admincr&mod=form&action=guide&step=1">
			<input type="hidden" value="{FORMHASH}" name="formhash"/>
			<table id="step_1">
				<tr>
					<th width="15%">{lang xplus:form_guide_title}</th>
					<td width="45%">
						<input class="px" type="text" value="{$title}" name="title" size="40" />
					</td>
					<td width="40%"></td>
				</tr>
				<tr>
					<th>&nbsp;</th>
					<td colspan="3">
						<button type="submit" name="step1_submit" value="true" class="pn vm"><em>{lang submit}</em></button>
					</td>
				</tr>
			</table>
		</form>
	</div>
</div>
<!--{elseif $step == 2}-->
<div class="bm bw0">  
	<div class="exfm">
		<h2>{lang xplus:form_list_edit} - {$form[title]}</h2> 
		<form method="POST" action="plugin.php?id=xplus:admincr&mod=form&action=guide&step=2&formid={$formid}&inguide={$inguide}">
			<input type="hidden" value="{FORMHASH}" name="formhash"/>
			<input type="hidden" id="formscrolltop" name="scrolltop" value="" />
			<input type="hidden" name="anchor" value="" /> 
			<table cellspacing="0" cellpadding="0">
				<tr>
					<th width="15%">{lang xplus:form_guide_title}</th>
					<td width="45%">
						<input class="px" type="text" value="{$form[title]}" name="formnew[title]" size="40" />
					</td>
					<td width="40%"></td>
				</tr>
				<tr>
					<th width="15%">{lang xplus:form_setting_available}</th>
					<td width="45%">
						<ul>
							<li><label><input type="radio" onclick="" {if $form[available] == 1}checked="checked"{/if} value="1" name="formnew[available]" class="radio">{lang xplus:form_yes}</label></li>
							<li><label><input type="radio" onclick="" {if $form[available] == 0}checked="checked"{/if} value="0" name="formnew[available]" class="radio">{lang xplus:form_no}</label></li>
						</ul>
					</td>
					<td width="40%" class="tips2">{lang xplus:form_setting_available_des}</td>
				</tr>
				<tr>
					<th width="15%">{lang xplus:form_setting_user}</th>
					<td width="45%">
						<input class="px" type="text" value="{$form[valuenum]}" name="formnew[valuenum]" size="40" />
					</td>
					<td width="40%"></td>
				</tr>
				<tr>
				<script src="static/js/calendar.js" type="text/javascript"></script>
					<th width="15%">{lang xplus:form_setting_time}</th>
					<td width="45%">
						<input class="px" type="text" value="$form[starttime]" name="formnew[starttime]" size="15" onclick="showcalendar(event, this);"/> --
						<input class="px" type="text" value="$form[endtime]" name="formnew[endtime]" size="15" onclick="showcalendar(event, this);"/>
					</td>
				<td width="40%" class="tips2">{lang xplus:form_setting_time_des}</td>
				</tr>
				<tr>
					<th width="15%">{lang xplus:form_setting_template}</th>
					<td width="45%">
						<span class="ftid">
							<select name="formnew[templateid]" id="template" width="168" class="ps">
							<!--{loop $templates $template}-->
								<option value="$template[templateid]" {if $form[templateid] == $template[templateid]}selected="selected" {/if} >{$template[name]}</option>
							<!--{/loop}-->
							</select>
						</span>
					</td>
					<td width="40%" class="tips2"></td>
				</tr>
				<tr>
					<th width="15%">{lang xplus:form_setting_introduce}</th>
					<td width="45%">
						<textarea rows="6" name="formnew[seodesc]" id="introduce" cols="50" class="tarea tta pt">$form[seodesc]</textarea>
					</td>
					<td width="40%" class="tips2">{lang xplus:form_setting_introduce_des}</td>
				</tr>
				<tr>
					<th width="15%">{lang xplus:form_setting_keywords}</th>
					<td width="45%">
						<input class="px" type="text" value="$form[seokeywords]" name="formnew[seokeywords]" size="40" />
					</td>
					<td width="40%" class="tips2">{lang xplus:form_setting_keywords_des}</td>
				</tr>
				<tr>
					<th width="15%">{lang xplus:form_setting_description}</th>
					<td width="45%">
						<textarea rows="6" name="formnew[description]" id="description" cols="50" class="tarea tta pt">$form[description]</textarea>
					</td>
					<td width="40%" class="tips2">{lang xplus:form_setting_keywords_des}</td>
				</tr>
				<tr>
					<th>&nbsp;</th>
					<td colspan="3">
						<button type="submit" name="formdetailsubmit" value="true" class="pn vm">
						<em>{lang xplus:submit}</em>
						</button>
					</td>
				</tr>
			</table>
		</form>
	</div>
</div>
<script type="text/JavaScript">_attachEvent(document.documentElement, 'keydown', function (e) { entersubmit(e, 'formdetailsubmit'); });</script>
<!--{elseif $step == 3}-->  
<div class="bm bw0">  
    <form name="cpform" method="post" autocomplete="off" action="plugin.php?id=xplus:admincr&mod=form&action=guide&step=3&formid=$formid&inguide=$inguide" id="cpform" >
	<input type="hidden" name="formhash" value="{FORMHASH}" />
	<input type="hidden" id="formscrolltop" name="scrolltop" value="" />
	<input type="hidden" name="anchor" value="" /> 
    <div class="exfm">
    	<h2>{lang xplus:form_list_field}</h2> 	
        <!--{if $inguide == 0}-->
        <h3><a href="plugin.php?id=xplus:admincr&mod=form&action=fieldlist&type=admin">&laquo;{lang xplus:form_field_manage}</a></h3>
    	<!--{/if}-->
        <table> 
            <tr>
                <td colspan="4">
                    <p class="tips">
                        {lang xplus:form_field_skill}
                    </p>
                </td>
            </tr>
    		<tr>
    			<th width="15%">{lang xplus:form_field_choice}</th>
    			<td id="classlist"></td>
    		</tr>
    		<tr>
    			<th width="15%"></th>
    			<td id="fieldlist"></td>
    		</tr>
    	</table> 
    </div> 
    <table class="dt lt" id="thisfieldlist">
        <tbody>
    		<tr>
    			<th width="20"></th>
    			<th width="60">{lang xplus:form_field_order}</th>
    			<th width="60">{lang xplus:form_field_available}</th>
    			<th>{lang xplus:form_field_name}</th>
    			<th width="120">{lang xplus:form_field_type}</th>
    			<th width="60">{lang xplus:form_field_must}</th>
    			<th width="60">{lang xplus:form_field_search}</th>
    			<th width="60">{lang xplus:form_field_list}</th>
    			<th width="180"></th>
    		</tr>
            <!--{loop $showfield $field}-->
            <tr id="fieldid_{$field[fieldid]}">
                <td><input class="pc" type="checkbox" name="delete[]" value="{$field[fieldid]}" /></td>
                <td><input class="px" type="text" size="2" name="displayorder[{$field[fieldid]}]" value="{$field[displayorder]}" /></td>
                <td><input class="pc" type="checkbox" name="available[{$field[fieldid]}]" value="{$field[fieldid]}" {if $field[available]} checked="checked" {/if} /></td>
                <td>{$field[title]}</td>
                <td>{$field[type]}</td>
                <td><input class="pc" type="checkbox" name="required[{$field[fieldid]}]" value="{$field[fieldid]}" {if $field[required]} checked="checked" {/if} /></td>
                <td><input class="pc" type="checkbox" name="search[{$field[fieldid]}]" value="{$field[fieldid]}" {if $field[search]} checked="checked" {/if} /></td>
                <td><input class="pc" type="checkbox" name="listshow[{$field[fieldid]}]" value="{$field[fieldid]}" {if $field[listshow]} checked="checked" {/if} /></td>
                <td><a href="plugin.php?id=xplus:admincr&mod=form&action=fielddetail&fieldid={$field[fieldid]}">{lang xplus:edit}</a></td>
            </tr>
            <!--{/loop}-->
            <tr>    
    			<td colspan="8" class="nb">
                    <input type="checkbox" name="chkall" id="chkall" class="pc" onclick="checkall(this.form, 'delete')" />
    				<label for="chkall">{lang delete}</label>
    				<button type="submit" name="formdetailsubmit" value="true" class="pn vm">
    				<em>{lang xplus:submit}</em>
    				</button>
    			</td>
            </tr>
         </tbody>   
    </table> 
    </form>
</div>
<script type="text/JavaScript">
	var fieldids = new Array();
	{$jsfieldids}
	function checkedbox() {
		var tags = $('fieldlist').getElementsByTagName('input');
		for(var i=0; i<tags.length; i++) {
			if(in_array(tags[i].value, fieldids)) {
				tags[i].checked = true;
			}
		}
	}
	function insertfield(fieldid) {
		var x = new Ajax();
		x.fieldid = fieldid;
		x.get('plugin.php?id=xplus:admincr&mod=field&action=formdetail&do=ajaxfield&inajax=1&fieldid=' + fieldid, function(s, x) {
			if(!in_array(x.fieldid, fieldids)) {
				var div = document.createElement('div');
				div.style.display = 'none';
				$('append_parent').appendChild(div);
				div.innerHTML = '<table>' + s + '</table>';
				var tr = div.getElementsByTagName('tr');
                tr[0].id = 'fieldid_' + x.fieldid;
				var trs = $('thisfieldlist').getElementsByTagName('tr');
				var trsparent = trs[trs.length - 1].parentNode;
				tr[0].id = 'fieldid_' + fieldid;
				if((BROWSER.ie && BROWSER.ie < 9) || BROWSER.msie) {
					trsparent.insertBefore(tr[0], trsparent.childNodes[1]);
				} else {
					trsparent.insertBefore(tr[0], trsparent.childNodes[2]);
				}
				$('append_parent').removeChild(div);
				fieldids.push(x.fieldid);
			} else {
				$('fieldid_' + x.fieldid).parentNode.removeChild($('fieldid_' + x.fieldid));
				for(var i=0; i<fieldids.length; i++) {
					if(fieldids[i] == x.fieldid) {
						fieldids[i] = 0;
					}
				}
			}
		});
	}
</script>
<script type="text/JavaScript">ajaxget('plugin.php?id=xplus:admincr&mod=field&action=formdetail&do=ajaxclasslist&formid=$formid&inguide=$inguide', 'classlist');</script>
<script type="text/JavaScript">ajaxget('plugin.php?id=xplus:admincr&mod=field&action=formdetail&do=ajaxfieldlist&classid=1&formid=$formid', 'fieldlist', '', '', '', checkedbox);</script>
<!--{/if}-->  